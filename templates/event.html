<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ボルダで決めったー</title>
    <link rel='stylesheet' href="../src/style.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  </head>
  <body>
    <header>
      <a href="/" class="icon">ボルダで決めったー</a>
    </header>
    <div class="l-main">
      <h1>投票イベント</h1>
      <a href="/event/{{.event.ID}}/edit" class="btn btn-inverse event-edit-btn">編集</a>
      <div class="event-info">
        <h2>テーマ</h2>
        <div class="l-align-center">
          <p class="event-theme">{{ .event.Theme }}</p>
        </div>
      </div>
      {{ if .event.Detail }}
        <div class="event-info">
          <h2>説明</h2>
          <div class="l-align-center">
            <p>{{ .event.Detail }}</p>
          </div>
        </div>
      {{ end }}
      {{ if .event.Finished }}
        <h2>投票結果</h2>
        <ul>
          {{ range .result }}
            <li>{{ .ChoiceName }}（{{ .TotalScore }}点）</li>
          {{ end }}
        </ul>
      {{ else }}
        <div class="event-info">
          <h2>選択肢</h2>
          <div class="l-align-center">
            <ul>
              {{ range .event.Choices }}
                <li>{{ .Name }}</li>
              {{ end }}
            </ul>
          </div>
        </div>
        <div class="l-align-center">
          <a href="/vote/{{.event.ID}}" class="btn">投票フォームへ</a>
        </div>
        <div class="l-align-center">
          <span class="btn btn-inverse vote-list-btn" id="modal-open-btn">投票者一覧</span>
        </div>
        <div class="l-modal is-modal-invisible" id="modal">
          <div class="modal-item">
            <div class="modal-header">
              <span class="modal-close-btn" id="modal-close-btn">×</span>
              <h3>投票者一覧（{{ len .event.Votes }}名）</h3>
            </div>
            <div class="modal-content">
              <p>
                {{ range $i, $v := .event.Votes }}{{ if ne $i 0 }}、{{ end }}{{ $v.Name }}{{ end }}
              </p>
            </div>
          </div>

        </div>
        <form method="post" style="margin: 0;" action="/finishevent/{{.event.ID}}">
          <div class="l-align-center">
            <button type="submit" class="btn event-finish-btn">投票を終了する</button>
            <p class="finish-btn-explain">※投票を終了して結果を表示します。イベント作成時のパスワードが必要になります。</p>
          </div>
        </form>
      {{ end }}
    </div>
    <footer>
      <span>&copy; 2018 Joichiro Hashikawa All Rights Reserved.</span>
    </footer>
  </body>
</html>

<script>
  $(function() {
    $('#modal-open-btn').click(function() {
      $('#modal').removeClass('is-modal-invisible');
    });

    $('#modal-close-btn').click(function() {
      $('#modal').addClass('is-modal-invisible')
    });
  });
</script>
